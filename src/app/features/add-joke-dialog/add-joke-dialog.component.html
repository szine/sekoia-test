<div 
  #dialog
  class="dialog-backdrop"
  (click)="onBackdropClick($event)"
  role="dialog"
  aria-modal="true"
  aria-labelledby="dialog-title"
  [attr.aria-describedby]="error() ? 'dialog-error' : null"
>
  <div class="dialog">
    <div class="dialog__header">
      <h2 id="dialog-title" class="dialog__title">{{ i18n.t().addJoke.title }}</h2>
      <button
        type="button"
        class="dialog__close"
        (click)="onClose()"
        aria-label="Close dialog"
      >
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 1.41L12.59 0L7 5.59L1.41 0L0 1.41L5.59 7L0 12.59L1.41 14L7 8.41L12.59 14L14 12.59L8.41 7L14 1.41Z" fill="currentColor"/>
        </svg>
      </button>
    </div>

    <form class="dialog__form" (submit)="onSubmit(); $event.preventDefault()">
      <!-- Type Selection -->
      <div class="dialog__field">
        <label class="dialog__label">
          Type <span class="dialog__required">*</span>
        </label>
        <div class="dialog__radio-group">
          <label class="dialog__radio">
            <input
              type="radio"
              name="jokeType"
              value="single"
              [checked]="jokeType() === 'single'"
              (change)="onTypeChange('single')"
              [disabled]="isSubmitting()"
            />
            <span>Single</span>
          </label>
          <label class="dialog__radio">
            <input
              type="radio"
              name="jokeType"
              value="twopart"
              [checked]="jokeType() === 'twopart'"
              (change)="onTypeChange('twopart')"
              [disabled]="isSubmitting()"
            />
            <span>Two-part</span>
          </label>
        </div>
      </div>

      <!-- Category Selection -->
      <div class="dialog__field">
        <label for="category-select" class="dialog__label">
          Category <span class="dialog__required">*</span>
        </label>
        <select
          id="category-select"
          class="dialog__select"
          [value]="category()"
          (change)="onCategoryChange($any($event.target).value)"
          [disabled]="isSubmitting()"
        >
          @for (cat of categories; track cat) {
            <option [value]="cat">{{ cat }}</option>
          }
        </select>
      </div>

      <!-- Single Joke Input -->
      @if (jokeType() === 'single') {
        <div class="dialog__field">
          <label for="joke-input" class="dialog__label">
            {{ i18n.t().addJoke.jokeLabel }} <span class="dialog__required">*</span>
          </label>
          <textarea
            #jokeInput
            id="joke-input"
            class="dialog__textarea"
            [value]="jokeText()"
            (input)="onInput($any($event.target).value)"
            [placeholder]="i18n.t().addJoke.jokePlaceholder"
            rows="6"
            [disabled]="isSubmitting()"
            required
            minlength="10"
          ></textarea>
          <div class="dialog__hint">
            {{ i18n.t().addJoke.jokeHint }}
          </div>
        </div>
      }

      <!-- Two-part Joke Inputs -->
      @if (jokeType() === 'twopart') {
        <div class="dialog__field">
          <label for="setup-input" class="dialog__label">
            {{ i18n.t().addJoke.setupLabel }} <span class="dialog__required">*</span>
          </label>
          <textarea
            #jokeInput
            id="setup-input"
            class="dialog__textarea"
            [value]="setup()"
            (input)="onSetupInput($any($event.target).value)"
            [placeholder]="i18n.t().addJoke.setupPlaceholder"
            rows="3"
            [disabled]="isSubmitting()"
            required
            minlength="5"
          ></textarea>
          <div class="dialog__hint">
            {{ i18n.t().addJoke.setupHint }}
          </div>
        </div>

        <div class="dialog__field">
          <label for="delivery-input" class="dialog__label">
            {{ i18n.t().addJoke.deliveryLabel }} <span class="dialog__required">*</span>
          </label>
          <textarea
            id="delivery-input"
            class="dialog__textarea"
            [value]="delivery()"
            (input)="onDeliveryInput($any($event.target).value)"
            [placeholder]="i18n.t().addJoke.deliveryPlaceholder"
            rows="3"
            [disabled]="isSubmitting()"
            required
            minlength="5"
          ></textarea>
          <div class="dialog__hint">
            {{ i18n.t().addJoke.deliveryHint }}
          </div>
        </div>
      }

      @if (error()) {
        <div 
          id="dialog-error"
          class="dialog__error"
          role="alert"
          aria-live="polite"
        >
          {{ error() }}
        </div>
      }

      <div class="dialog__actions">
        <button
          type="button"
          class="dialog__button dialog__button--secondary"
          (click)="onClose()"
          [disabled]="isSubmitting()"
        >
          {{ i18n.t().addJoke.cancel }}
        </button>
        <button
          type="submit"
          class="dialog__button dialog__button--primary"
          [disabled]="!isValid || isSubmitting()"
        >
          @if (isSubmitting()) {
            <span>Adding...</span>
          } @else {
            <span>{{ i18n.t().addJoke.add }}</span>
          }
        </button>
      </div>
    </form>
  </div>
</div>
